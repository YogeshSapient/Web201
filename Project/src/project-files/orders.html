<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <link href="https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900" rel="stylesheet">
    <!-- <link rel="stylesheet" href="dist/style.css"> -->
    <link rel="shortcut icon" type="image/png" href="img/favicon.png">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.js"></script>
    <title>Order Food Online & Get Healthy Food Delivery Near You | Eat.Fit</title>

</head>

<body>
    <!-- Start Header -->
    <header class="top-header">
        <div class="column column1">
            <img src="Images/logo.png" alt="Logo">
        </div>
        <div class="column column2">
            <div class="menu__navigation">
                <ul class="menur__list">
                    <li class="menu__item"><a href="index.html" class="menu__link">Home</a></li>
                    <li class="menu__item"><a href="orders.html" class="menu__link">Cart<span id="cartItem"></span></a></li>
                    <li class="menu__item"><a href="#" class="menu__link">  Privacy policy</a></li>
                </ul>
            </div>
        </div>
    </header>

    <!-- Start main section -->
    <main>
        <section class="section-about">
            <div class="row">
                <!-- entry-template for  Breakfast-->
                <div class="container">
                    <div class="row">
                    </div>
                    <div class="row">
                    </div>
                    <div class="row">
                    </div>

                    <div class="row" id="test" style="padding: 20px 0px 20px 0px">

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="u-center-text u-margin-top-huge">
                    <a href="#" class="btn btn--green">Place Order</a>
                </div>
            </div>
        </section>
    </main>

    <!-- Start Footer -->
    <footer class="footer">
        <div class="footer__navigation">
            <ul class="footer__list">
                <li class="footer__item"><a href="#" class="footer__link">Home</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Cart</a></li>
                <li class="footer__item"><a href="#" class="footer__link">Privacy policy</a></li>
            </ul>
        </div>
    </footer>

    <script>
        var selected_index = -1; //Index of the selected list item 
        var contextCart = [];

        contextCart = localStorage.getItem('cartItems');
        contextCart = JSON.stringify(contextCart);
        contextCart = JSON.parse(contextCart);
        var shoppintCart = JSON.parse(contextCart);
        isCartEmpty(shoppintCart)
        for (var i in shoppintCart) {
            var data = JSON.parse(shoppintCart[i]);
            createMarkup(data, i);
        }

        function createMarkup(data, i) {
            debugger;
            $("#test").append(
                "<div class='card card-desktop'>" +
                "<div class='col-1-of-4'>" + "<img class='cart-image' src=" + data.foodImage + ">" + "</div>" +
                "<div class='col-1-of-4'>" +
                "<div class='product-cart-image'>" + data.foodName + "</div>" + "<div class='product-cart-imageRemove' id='" + data.cartID + "'>" + "<button class='add-cart-remove'>Remove</button>" + "</div>" + "</div>" +

                "<div class='col-1-of-4 product-cart-image'>" + "â‚¹ " + parseInt(data.foodPrice.substring(2, data.foodPrice.length)) * parseInt(data.quantity) + "</div>" + "<div class='col-1-of-4 product-cart-image' id='" + "u" + data.cartID + "'>" + "<input type='text' id='" + i + "' class='quantity-textbox' name='quantity' value='" + data.quantity + "'>" + "</div>" + "</div>");
        }

        //selected_index = parseInt($(this).attr("id"));
        $(document).on("click", '.add-cart-remove', Delete);

        function Delete(e) {
            const shoppintCart = JSON.parse(localStorage.getItem('cartItems'));
            const tmp = shoppintCart.filter((item) => {
                item = JSON.parse(item);
                return item.cartID != e.target.parentElement.id;
            });
            localStorage.setItem('cartItems', JSON.stringify(tmp));
            let newshoppintCart = localStorage.getItem('cartItems');
            newshoppintCart = JSON.parse(newshoppintCart);
            $("#cartItem").text(" " + "(" + newshoppintCart.length + "  " + "Items" + ")");
            $("#test").html('');
            for (var i in newshoppintCart) {
                var data = JSON.parse(newshoppintCart[i]);
                createMarkup(data, i);
            }
            isCartEmpty(newshoppintCart);
        }

        function isCartEmpty(cart) {
            if (cart.length == 0) {
                $("#test").append(
                    "<div class='card card-desktop'>" + "<img class='emptycart-image' src='Images/emptyCart.PNG'>" +
                    "</div>");
            }

        }
        $(document).on("change", '.quantity-textbox', UpdateQuantity);






        function UpdateQuantity(e) {
            debugger;
            const updatecart = JSON.parse(localStorage.getItem('cartItems'));
            var id = parseInt($(this).attr("id"));
            var updateid = e.target.parentElement.id.substring(1, e.target.parentElement.id.length);
            const updateQuantity = [];
            for (var i in updatecart) {
                var data = JSON.parse(updatecart[i]);

                if (data.cartID == updateid) {
                    data['quantity'] = e.target.value;
                    var ax = JSON.stringify(data);
                    updateQuantity.push(ax);
                } else {
                    var withoutupdate = JSON.stringify(data);
                    updateQuantity.push(withoutupdate);
                }
            }
            localStorage.setItem('cartItems', JSON.stringify(updateQuantity));
            let newupdateshoppintCart = localStorage.getItem('cartItems');
            newupdateshoppintCart = JSON.parse(newupdateshoppintCart);
             $("#test").html('');
            for (var i in newupdateshoppintCart) {
                var data = JSON.parse(newupdateshoppintCart[i]);
                createMarkup(data, i);
            }
            
        }
    </script>
</body>

</html>